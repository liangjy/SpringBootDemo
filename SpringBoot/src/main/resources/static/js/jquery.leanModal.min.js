// leanModal v1.1 by Ray Stone - http://leanmodal.finelysliced.com.au
// Dual licensed under the MIT and GPL

(function($) {
	$.fn.extend({
		leanModal : function(options) {
			var defaults = {
			    title:'',
				top : 10,
				overlay : 0.5,
				isHasClose:true,
				closeButton : null,
				closeFun:function(){} 
			};
			var overlay = $("<div id='lean_overlay'></div>");
			$("body").append(overlay);
			options = $.extend(defaults, options);
			return this.each(function() {
				var o = options;
				$(this).click(function(e) {
					var modal_id = $(this).attr("href");
					$("#lean_overlay").click(function() {
						//close_modal(modal_id)
					});
					
					var modal_height = $(modal_id).outerHeight();
					var modal_width = $(modal_id).outerWidth();
					$("#lean_overlay").css({
						"display" : "block",
						opacity : 0
					});
					$("#lean_overlay").fadeTo(200, o.overlay);
					$(modal_id).css({
						"display" : "block",
						"position" : "fixed",
						"opacity" : 0,
						"z-index" : 1000,
						"left" : 50 + "%",
						"margin-left" : -(modal_width / 2) + "px",
						"top" : o.top + "px"
					});
					
					$(modal_id).addClass("openWindow");
					
					var head = "<div id=\"OpenWindow-header\"><b>"+o.title+"</b>";
					if(o.isHasClose){
						head +="<a href=\"###\" class=\"modal_close\"></a>";
					}else{
						head +="<a href=\"###\" class=\"hidden_modal_close\"></a>"
					}
				    head +="</div>";
					
					
					$(modal_id).draggable({ handle: "#OpenWindow-header" });
					$(modal_id).prepend(head);
					
					$(o.closeButton).click(function() { 
						close_modal(modal_id); 
						o.closeFun();
					}); 
					
					$(".hidden_modal_close").click(function() { 
						close_modal(modal_id); 
					}); 
					
					
					$(modal_id).fadeTo(200, 1);
					 
					
					e.preventDefault()
				});
			});
			function close_modal(modal_id) {
				$("#lean_overlay").fadeOut(200);
				$(modal_id).css({
					"display" : "none"
				}); 
			    $(modal_id).find("#OpenWindow-header").remove(); 
				//隐藏验证提示框   
				//$(modal_id).find("form").validationEngine('hide');
				
			}
		}
	});
})(jQuery);
